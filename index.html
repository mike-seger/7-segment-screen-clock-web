<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AMOLED Clock</title>

<!-- Load @font-face rules; fonts referenced inside fonts/fonts.css -->
<link rel="stylesheet" href="fonts/fonts.css">

<style>
    :root {
        --bg: #000000;
        --on-color: #00ff5a;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html, body {
        width: 100%;
        height: 100%;
    }

    body {
        background: var(--bg);
        color: var(--on-color);
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: monospace;
        overflow: visible; /* reduce clipping when scaling */
    }

    #app {
        position: relative;
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #clock {
        text-align: center;
        padding: 2vmin;
    }

    .line {
        white-space: nowrap;
    }

    #date-line {
        margin-bottom: 5vmin;
        display: flex;
        justify-content: center;
        align-items: baseline;
        gap: 1.5ch;
        line-height: 1.0;
    }

    #time-line {
        display: flex;
        justify-content: center;
        align-items: baseline;
        gap: 2vmin;
        line-height: 1.0;
    }

    #time-main {
        display: inline-flex;
        align-items: baseline;
        gap: 0.5ch;
    }

    #time-seconds {
        display: inline-flex;
        align-items: baseline;
        gap: 0.2ch;
    }

    /* group markers for JS */
    .numeric-group,
    .alpha-group {
        display: inline-block;         /* required for transform scaling */
        transform-origin: center center;
    }

    .weekday.alpha-group,
    .month.alpha-group {
        letter-spacing: 0.25em;
    }

    /* ≡ toggle */
    #settings-toggle {
        position: absolute;
        top: 1.5vmin;
        right: 1.5vmin;
        width: 3rem;
        height: 3rem;
        border-radius: 999px;
        border: 1px solid #222;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.6rem;
        cursor: pointer;
        color: #ccc;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(6px);
        z-index: 10;
        user-select: none;
    }

    #settings-toggle:hover {
        background: rgba(40,40,40,0.95);
    }

    /* panel */
    #settings-panel {
        position: absolute;
        top: 5.5vmin;
        right: 1.5vmin;
        width: 340px;
        max-height: 90vh;
        padding: 1rem 1rem 1.2rem;
        border-radius: 0.9rem;
        background: rgba(10,10,10,0.96);
        color: #ddd;
        box-shadow: 0 0 20px rgba(0,0,0,0.8);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 0.85rem;
        display: none;
        overflow-y: auto;
        z-index: 9;
    }

    #settings-panel.open {
        display: block;
    }

    #settings-panel h3 {
        font-size: 0.9rem;
        margin: 0.3rem 0 0.4rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #aaa;
    }

    #settings-panel section {
        border-top: 1px solid #333;
        padding-top: 0.5rem;
        margin-top: 0.5rem;
    }

    #settings-panel section:first-of-type {
        border-top: none;
        padding-top: 0;
        margin-top: 0;
    }

    .control-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
        margin-bottom: 0.35rem;
    }

    .control-row label {
        flex: 0 0 90px;
        color: #aaa;
    }

    .control-row select,
    .control-row input[type="text"] {
        flex: 1;
        padding: 0.2rem 0.35rem;
        border-radius: 0.3rem;
        border: 1px solid #444;
        background: #111;
        color: #eee;
        outline: none;
    }

    .control-row select:focus,
    .control-row input[type="text"]:focus {
        border-color: #666;
    }

    .slider-row {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        margin-bottom: 0.35rem;
    }

    .slider-row label {
        flex: 0 0 90px;
        color: #aaa;
    }

    .slider-row input[type="range"] {
        flex: 1;
    }

    .slider-value {
        width: 3.5rem;
        text-align: right;
        font-variant-numeric: tabular-nums;
        color: #888;
    }

    .color-row input[type="color"] {
        width: 45px;
        height: 24px;
        padding: 0;
        border-radius: 0.3rem;
        border: 1px solid #444;
        background: transparent;
    }

    .preset-buttons {
        display: flex;
        gap: 0.4rem;
        margin-top: 0.3rem;
    }

    .preset-buttons button {
        flex: 1;
        padding: 0.25rem 0.4rem;
        border-radius: 0.3rem;
        border: 1px solid #444;
        background: #181818;
        color: #eee;
        cursor: pointer;
        font-size: 0.8rem;
    }

    .preset-buttons button:hover {
        background: #242424;
    }

    .preset-row {
        display: flex;
        gap: 0.4rem;
        margin-bottom: 0.4rem;
    }

    .preset-row select {
        flex: 1;
    }

    .section-title {
        font-weight: 600;
        margin: 0.2rem 0 0.2rem;
        color: #bbb;
    }

    hr {
        border: none;
        border-top: 1px solid #333;
        margin: 0.4rem 0;
    }
</style>
</head>
<body>
<div id="app">
    <div id="clock">
        <div id="date-line" class="line">
            <span id="weekday" class="alpha-group weekday"></span>
            <span id="day" class="numeric-group day"></span>
            <span id="month" class="alpha-group month"></span>
            <span id="year" class="numeric-group year"></span>
        </div>

        <div id="time-line" class="line">
            <span id="time-main">
                <span id="hh" class="numeric-group time-main-num"></span>
                <span class="numeric-group time-main-num-colon">:</span>
                <span id="mm" class="numeric-group time-main-num"></span>
            </span>
            <span id="time-seconds">
                <span class="numeric-group time-sec-colon">:</span>
                <span id="ss" class="numeric-group time-sec-num"></span>
            </span>
        </div>
    </div>

    <div id="settings-toggle">≡</div>

    <div id="settings-panel">
        <!-- Fonts & Scale -->
        <section>
            <h3>Fonts & Scale</h3>

            <div class="section-title">Numeric group (HH MM SS, day, year)</div>
            <div class="control-row">
                <label for="font-numeric">Font</label>
                <select id="font-numeric"></select>
            </div>
            <div class="slider-row">
                <label for="scale-numeric">Scale</label>
                <input type="range" id="scale-numeric" min="50" max="200" step="1">
                <div class="slider-value" id="scale-numeric-val"></div>
            </div>

            <div class="section-title" style="margin-top:0.4rem;">Alpha group (weekday, month)</div>
            <div class="control-row">
                <label for="font-alpha">Font</label>
                <select id="font-alpha"></select>
            </div>
            <div class="slider-row">
                <label for="scale-alpha">Scale</label>
                <input type="range" id="scale-alpha" min="50" max="200" step="1">
                <div class="slider-value" id="scale-alpha-val"></div>
            </div>
        </section>

        <!-- Line styles -->
        <section>
            <h3>Line Styles</h3>

            <div class="section-title">Date line</div>
            <div class="control-row color-row">
                <label for="color-date">Color</label>
                <input type="color" id="color-date">
            </div>
            <div class="slider-row">
                <label for="size-date">Font size</label>
                <input type="range" id="size-date" min="1" max="400" step="1">
                <div class="slider-value" id="size-date-val"></div>
            </div>

            <div class="section-title">Time main (HH:MM)</div>
            <div class="control-row color-row">
                <label for="color-time-main">Color</label>
                <input type="color" id="color-time-main">
            </div>
            <div class="slider-row">
                <label for="size-time-main">Font size</label>
                <input type="range" id="size-time-main" min="1" max="400" step="1">
                <div class="slider-value" id="size-time-main-val"></div>
            </div>

            <div class="section-title">Seconds</div>
            <div class="control-row color-row">
                <label for="color-time-sec">Color</label>
                <input type="color" id="color-time-sec">
            </div>
            <div class="slider-row">
                <label for="size-time-sec">Font size</label>
                <input type="range" id="size-time-sec" min="1" max="400" step="1">
                <div class="slider-value" id="size-time-sec-val"></div>
            </div>
        </section>

        <!-- Presets -->
        <section>
            <h3>Presets</h3>

            <div class="preset-row">
                <input type="text" id="preset-name" placeholder="Preset name">
                <button id="preset-save">Save</button>
            </div>

            <div class="preset-row">
                <select id="preset-list" size="3"></select>
            </div>

            <div class="preset-buttons">
                <button id="preset-load">Load</button>
                <button id="preset-delete">Delete</button>
            </div>
        </section>
    </div>
</div>

<script>
const dayNames   = ["SUN","MON","TUE","WED","THU","FRI","SAT"];
const monthNames = ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];

const STORAGE_KEY_CURRENT = "amoledClockConfigCurrent";
const STORAGE_KEY_PRESETS = "amoledClockConfigPresets";

/** default configuration */
const defaultConfig = {
    fonts: {
        numeric: "",   // will be filled after fonts are discovered
        alpha: ""      // same
    },
    scales: {
        numeric: 100,
        alpha: 100
    },
    lineFontSizes: {
        date: 36,
        timeMain: 160,
        timeSec: 80
    },
    colors: {
        date: "#00ff5a",
        timeMain: "#00ff5a",
        timeSec: "#00ff5a"
    }
};

let config = structuredClone(defaultConfig);

function mergeConfig(target, source) {
    for (const k in source) {
        if (source[k] && typeof source[k] === "object" && !Array.isArray(source[k])) {
            if (!target[k] || typeof target[k] !== "object") target[k] = {};
            mergeConfig(target[k], source[k]);
        } else {
            target[k] = source[k];
        }
    }
    return target;
}

/** Load current config from localStorage */
function loadCurrentConfig() {
    try {
        const raw = localStorage.getItem(STORAGE_KEY_CURRENT);
        if (!raw) return structuredClone(defaultConfig);
        const parsed = JSON.parse(raw);
        return mergeConfig(structuredClone(defaultConfig), parsed);
    } catch(e) {
        console.warn("Failed to load config, using defaults", e);
        return structuredClone(defaultConfig);
    }
}

/** Save current config */
function saveCurrentConfig() {
    try {
        localStorage.setItem(STORAGE_KEY_CURRENT, JSON.stringify(config));
    } catch(e) {
        console.warn("Failed to save config", e);
    }
}

/** Preset helpers */
function getPresets() {
    try {
        const raw = localStorage.getItem(STORAGE_KEY_PRESETS);
        if (!raw) return {};
        return JSON.parse(raw);
    } catch(e) {
        console.warn("Failed to load presets", e);
        return {};
    }
}

function setPresets(obj) {
    try {
        localStorage.setItem(STORAGE_KEY_PRESETS, JSON.stringify(obj));
    } catch(e) {
        console.warn("Failed to save presets", e);
    }
}

/** Apply config to DOM */
function applyFontsAndScale() {
    const numericEls = document.querySelectorAll(".numeric-group");
    numericEls.forEach(el => {
        if (config.fonts.numeric) {
            el.style.fontFamily = `"${config.fonts.numeric}", monospace`;
        }
        el.style.transform = `scale(${config.scales.numeric/100})`;
    });

    const alphaEls = document.querySelectorAll(".alpha-group");
    alphaEls.forEach(el => {
        if (config.fonts.alpha) {
            el.style.fontFamily = `"${config.fonts.alpha}", monospace`;
        }
        el.style.transform = `scale(${config.scales.alpha/100})`;
    });
}

function applyLineStyles() {
    const dateLine = document.getElementById("date-line");
    const timeMainLine = document.getElementById("time-main");
    const timeSecLine = document.getElementById("time-seconds");

    dateLine.style.color = config.colors.date;
    dateLine.style.fontSize = config.lineFontSizes.date + "px";

    timeMainLine.style.color = config.colors.timeMain;
    timeMainLine.style.fontSize = config.lineFontSizes.timeMain + "px";

    timeSecLine.style.color = config.colors.timeSec;
    timeSecLine.style.fontSize = config.lineFontSizes.timeSec + "px";
}

function applyConfig() {
    applyFontsAndScale();
    applyLineStyles();
}

/** Update form controls to reflect config */
function syncFormFromConfig() {
    const fontNumeric = document.getElementById("font-numeric");
    const fontAlpha = document.getElementById("font-alpha");
    const scaleNumeric = document.getElementById("scale-numeric");
    const scaleAlpha = document.getElementById("scale-alpha");
    const scaleNumericVal = document.getElementById("scale-numeric-val");
    const scaleAlphaVal = document.getElementById("scale-alpha-val");

    const colorDate = document.getElementById("color-date");
    const colorTimeMain = document.getElementById("color-time-main");
    const colorTimeSec = document.getElementById("color-time-sec");

    const sizeDate = document.getElementById("size-date");
    const sizeTimeMain = document.getElementById("size-time-main");
    const sizeTimeSec = document.getElementById("size-time-sec");
    const sizeDateVal = document.getElementById("size-date-val");
    const sizeTimeMainVal = document.getElementById("size-time-main-val");
    const sizeTimeSecVal = document.getElementById("size-time-sec-val");

    if (fontNumeric && config.fonts.numeric) {
        fontNumeric.value = config.fonts.numeric;
    }
    if (fontAlpha && config.fonts.alpha) {
        fontAlpha.value = config.fonts.alpha;
    }

    scaleNumeric.value = config.scales.numeric;
    scaleAlpha.value = config.scales.alpha;
    scaleNumericVal.textContent = config.scales.numeric + "%";
    scaleAlphaVal.textContent = config.scales.alpha + "%";

    colorDate.value = config.colors.date;
    colorTimeMain.value = config.colors.timeMain;
    colorTimeSec.value = config.colors.timeSec;

    sizeDate.value = config.lineFontSizes.date;
    sizeTimeMain.value = config.lineFontSizes.timeMain;
    sizeTimeSec.value = config.lineFontSizes.timeSec;
    sizeDateVal.textContent = config.lineFontSizes.date + "px";
    sizeTimeMainVal.textContent = config.lineFontSizes.timeMain + "px";
    sizeTimeSecVal.textContent = config.lineFontSizes.timeSec + "px";
}

/** Populate preset list from localStorage */
function populatePresetList() {
    const select = document.getElementById("preset-list");
    const presets = getPresets();

    select.innerHTML = "";
    const names = Object.keys(presets).sort();
    for (const name of names) {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
    }
}

/** Discover font family names from fonts.css */
async function loadFontChoices() {
    try {
        const res = await fetch("fonts/fonts.css");
        if (!res.ok) throw new Error("HTTP " + res.status);
        const css = await res.text();

        const namesSet = new Set();
        const re = /font-family\s*:\s*["']?([^;"']+)["']?/gi;
        let m;
        while ((m = re.exec(css))) {
            const name = m[1].trim();
            if (name) namesSet.add(name);
        }
        return Array.from(namesSet);
    } catch (e) {
        console.warn("Could not load font choices:", e);
        return [];
    }
}

/** Populate font selects with discovered fonts */
function populateFontSelects(fontNames) {
    const fontNumeric = document.getElementById("font-numeric");
    const fontAlpha = document.getElementById("font-alpha");

    fontNumeric.innerHTML = "";
    fontAlpha.innerHTML = "";

    const addOptions = (select) => {
        fontNames.forEach(name => {
            const opt = document.createElement("option");
            opt.value = name;
            opt.textContent = name;
            select.appendChild(opt);
        });
    };

    addOptions(fontNumeric);
    addOptions(fontAlpha);

    // choose defaults if not set
    if (!config.fonts.numeric && fontNames.length) {
        config.fonts.numeric = fontNames[0];
    }
    if (!config.fonts.alpha && fontNames.length) {
        config.fonts.alpha = fontNames[0];
    }

    // reflect current config
    if (config.fonts.numeric) fontNumeric.value = config.fonts.numeric;
    if (config.fonts.alpha) fontAlpha.value = config.fonts.alpha;
}

/** Clock update */
function updateClock() {
    const now = new Date();

    const h = now.getHours().toString().padStart(2, "0");
    const m = now.getMinutes().toString().padStart(2, "0");
    const s = now.getSeconds().toString().padStart(2, "0");

    const dayIdx = now.getDay();
    const dayName = dayNames[dayIdx];
    const day = now.getDate().toString().padStart(2, "0");
    const monthName = monthNames[now.getMonth()];
    const year = now.getFullYear().toString();

    document.getElementById("weekday").textContent = dayName;
    document.getElementById("day").textContent = day;
    document.getElementById("month").textContent = monthName;
    document.getElementById("year").textContent = year;

    document.getElementById("hh").textContent = h;
    document.getElementById("mm").textContent = m;
    document.getElementById("ss").textContent = s;
}

/** Wiring */
document.addEventListener("DOMContentLoaded", async () => {
    // load config
    config = loadCurrentConfig();

    // toggle panel
    const toggle = document.getElementById("settings-toggle");
    const panel = document.getElementById("settings-panel");
    toggle.addEventListener("click", () => {
        panel.classList.toggle("open");
    });

    // load fonts
    const fontNames = await loadFontChoices();
    if (fontNames.length) {
        populateFontSelects(fontNames);
    }

    // bind form events
    const fontNumeric = document.getElementById("font-numeric");
    const fontAlpha = document.getElementById("font-alpha");
    const scaleNumeric = document.getElementById("scale-numeric");
    const scaleAlpha = document.getElementById("scale-alpha");
    const scaleNumericVal = document.getElementById("scale-numeric-val");
    const scaleAlphaVal = document.getElementById("scale-alpha-val");

    const colorDate = document.getElementById("color-date");
    const colorTimeMain = document.getElementById("color-time-main");
    const colorTimeSec = document.getElementById("color-time-sec");

    const sizeDate = document.getElementById("size-date");
    const sizeTimeMain = document.getElementById("size-time-main");
    const sizeTimeSec = document.getElementById("size-time-sec");
    const sizeDateVal = document.getElementById("size-date-val");
    const sizeTimeMainVal = document.getElementById("size-time-main-val");
    const sizeTimeSecVal = document.getElementById("size-time-sec-val");

    fontNumeric.addEventListener("change", () => {
        config.fonts.numeric = fontNumeric.value;
        applyFontsAndScale();
        saveCurrentConfig();
    });

    fontAlpha.addEventListener("change", () => {
        config.fonts.alpha = fontAlpha.value;
        applyFontsAndScale();
        saveCurrentConfig();
    });

    scaleNumeric.addEventListener("input", () => {
        const v = parseInt(scaleNumeric.value, 10);
        config.scales.numeric = v;
        scaleNumericVal.textContent = v + "%";
        applyFontsAndScale();
        saveCurrentConfig();
    });

    scaleAlpha.addEventListener("input", () => {
        const v = parseInt(scaleAlpha.value, 10);
        config.scales.alpha = v;
        scaleAlphaVal.textContent = v + "%";
        applyFontsAndScale();
        saveCurrentConfig();
    });

    colorDate.addEventListener("input", () => {
        config.colors.date = colorDate.value;
        applyLineStyles();
        saveCurrentConfig();
    });
    colorTimeMain.addEventListener("input", () => {
        config.colors.timeMain = colorTimeMain.value;
        applyLineStyles();
        saveCurrentConfig();
    });
    colorTimeSec.addEventListener("input", () => {
        config.colors.timeSec = colorTimeSec.value;
        applyLineStyles();
        saveCurrentConfig();
    });

    sizeDate.addEventListener("input", () => {
        const v = parseInt(sizeDate.value, 10);
        config.lineFontSizes.date = v;
        sizeDateVal.textContent = v + "px";
        applyLineStyles();
        saveCurrentConfig();
    });
    sizeTimeMain.addEventListener("input", () => {
        const v = parseInt(sizeTimeMain.value, 10);
        config.lineFontSizes.timeMain = v;
        sizeTimeMainVal.textContent = v + "px";
        applyLineStyles();
        saveCurrentConfig();
    });
    sizeTimeSec.addEventListener("input", () => {
        const v = parseInt(sizeTimeSec.value, 10);
        config.lineFontSizes.timeSec = v;
        sizeTimeSecVal.textContent = v + "px";
        applyLineStyles();
        saveCurrentConfig();
    });

    // presets
    const presetNameInput = document.getElementById("preset-name");
    const presetList = document.getElementById("preset-list");
    const presetSaveBtn = document.getElementById("preset-save");
    const presetLoadBtn = document.getElementById("preset-load");
    const presetDeleteBtn = document.getElementById("preset-delete");

    populatePresetList();

    presetSaveBtn.addEventListener("click", () => {
        const name = presetNameInput.value.trim();
        if (!name) {
            alert("Enter a preset name first.");
            return;
        }
        const presets = getPresets();
        presets[name] = structuredClone(config);
        setPresets(presets);
        populatePresetList();
        presetList.value = name;
    });

    presetLoadBtn.addEventListener("click", () => {
        const name = presetList.value;
        if (!name) return;
        const presets = getPresets();
        const loaded = presets[name];
        if (!loaded) return;
        config = mergeConfig(structuredClone(defaultConfig), loaded);
        syncFormFromConfig();
        applyConfig();
        saveCurrentConfig();
    });

    presetDeleteBtn.addEventListener("click", () => {
        const name = presetList.value;
        if (!name) return;
        const presets = getPresets();
        if (!(name in presets)) return;
        delete presets[name];
        setPresets(presets);
        populatePresetList();
    });

    // now sync form and apply config first time
    syncFormFromConfig();
    applyConfig();

    // start clock
    updateClock();
    setInterval(updateClock, 250);
});
</script>
</body>
</html>
